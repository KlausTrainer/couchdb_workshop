<!DOCTYPE html>
<!--
  Google HTML5 slide template

  Authors: Luke Mahé (code)
           Marcin Wichary (code and design)
           
           Dominic Mazzoni (browser compatibility)
           Charles Chen (ChromeVox support)

  URL: http://code.google.com/p/html5slides/
-->
<html>
  <head>
    <title>Building a CouchApp with Kanso</title>
    <meta charset='utf-8'>
    <!-- external - preferred!
    <script src='http://html5slides.googlecode.com/svn/trunk/slides.js'></script> 
    -->
    
    <!-- locally -->
    <script src='javascripts/slides.js'></script>
    <script src='javascripts/prettify.js'></script>
    <link rel="stylesheet" type="text/css" href="stylesheets/styles.css">

    <link rel="stylesheet" type="text/css" href="stylesheets/styles_additional.css">
  </head>
  <body style='display: none'>
    <section class='slides layout-regular'>
      <article class='biglogo'>
        <h1>Kanso</h1>
        <img src="images/kanso.png" />
      </article>

      <article>
        <h2>
          Installation
        </h2>
        <p>&nbsp;</p>
        <p>What we need:</p>
        <ul>
          <li>CouchDB</li>
          <li>Node.js <span class="small">(homebrew ...)</span></li>
          <li>npm <span class="small">(via installer)</span></li>
        </ul>
        <br />
        <p>The result will be a pure CouchApp - YaY ;-)</p>
        <p>&nbsp;</p>
        <p>Check all CouchApp tools at <a href="http://couchapp.org/page/index">http://couchapp.org</a></p>
      </article>

      <article class="smaller">
        <h2>
          Installation - installing kanso itself
        </h2>
        <p>&nbsp;</p>
        <section>
          <pre>
sudo npm install -g kanso
npm http GET https://registry.npmjs.org/kanso
npm http 200 https://registry.npmjs.org/kanso
npm http GET https://registry.npmjs.org/kanso/-/kanso-0.2.1.tgz
npm http 200 https://registry.npmjs.org/kanso/-/kanso-0.2.1.tgz
npm http GET https://registry.npmjs.org/mime/1.2.4
[...]
/usr/local/bin/kanso -> /usr/local/lib/node_modules/kanso/bin/kanso
/usr/local/bin/kanso_completions -> /usr/local/lib/node_modules/kanso/scripts/autocomp.js
kanso@0.2.1 /usr/local/lib/node_modules/kanso 
├── semver@1.0.9
├── mime@1.2.4
├── underscore@1.1.7
├── async@0.1.15
├── csv@0.0.9
├── parser@0.1.2 (tokenizer@0.1.0)
└── prompt@0.1.11
          </pre>
        </section>
        <p>check it</p>
        <section>
          <pre>
kanso -v
0.2.1
          </pre>
        </section>
      </article>

      <article>
        <h2>
          The idea
        </h2>
        <br />
        <ul>
          <li><i><b>install</b></i> the basic application structure with a simple command</li>
          <li>provide a CLI to easily <i><b>push</b></i> application files to CouchDB</li>
          <li>ressources are placed in a _design document</li>
          <li>update the application contents very fast</li>
          <li><i><b>upload</b></i> JSON data easily to CouchDB</li>
          <li>use CommonJS modules</li>
          <li><i><b>load</b></i> third party extensions like templating and frameworks</li>
          <li>support CoffeeScript - check!</li>  
        </ul> 
      </article>

      <article class="smaller">
        <h2>
          available commands
        </h2>
        <br />
        <section>
          <pre>
kanso
Usage: kanso COMMAND [ARGS]

Available commands:
  help           Show help specific to a command
  push           Load a project and push to a CouchDB database
  upload         Upload a file or directory of JSON files to DB
  show           Load a project and output resulting JSON
  createdb       Create a new CouchDB database
  deletedb       Delete a CouchDB database
  listdb         List databases on a CouchDB instance
  replicate      Exchange data between databases
  transform      Performs tranformations on JSON files
  uuids          Returns UUIDs generated by a CouchDB instance
  pack           Pack a package into a .tar.gz file
  publish        Publish a package to a repository
  unpublish      Remove a published package from a repository
  install        Installs a package and its dependencies
  update         Updates a package to the latest compatible version
  clean          Removes unused packages from the package directory
  clear-cache    Removes packages from the local cache
  ls             Builds a project and reports a list of its exports
          </pre>
        </section>
      </article>

      <article>
        <h2>
          Let's create the basic app: jug-kanso 
        </h2>
        <br />
        <br />
        <p><img src="images/kanso-structure.png" width="800"/></p>
      </article>

      <article>
        <h2>
          Bringing the app to CouchDB
        </h2>
        <br />
        <section>
          <pre>
kanso install
installing from directory .
[...]

kanso push http://localhost:5984/jug-kanso
Reading dependency tree...
loading .
[...]

curl -X GET http://localhost:5984/jug-kanso
{"db_name":"jug-kanso","doc_count":1,"doc_del_count":0,
 "update_seq":1, "purge_seq":0,"compact_running":false,
 "disk_size":4194,"data_size":2132,
 "instance_start_time":"1336596792152214",
 "disk_format_version":6,"committed_update_seq":1}
          </pre>
          <p>Check it in the <a href="http://localhost:5984/jug-kanso/_design/jug-kanso/index.html">browser</a></a>
        </section>
      </article>

      <article class="smaller">
        <h2>
          Adding data to CouchDB
        </h2>
        <br />
        <section>
          <pre>
[
    {
        "first_name": "Andy",
        "last_name": "Wenk",
        "city": "Hamburg",
        "twitter": "@awenkhh",
        "coding_skills": ["Ruby","Rails","JavaScript","HTML","CSS"],
        "age": 41
    },
    {
        "first_name": "Uwe",
        "last_name": "Sauerbrei",
        "city": "Buchholz",
        "twitter": "",
        "coding_skills": ["Java","HTML","CSS"],
        "age": 46
    },
    {
        "first_name": "Till",
        "last_name": "Klampaeckel",
        "city": "Berlin",
        "twitter": "@klimpong",
        "coding_skills": ["PHP","JavaScript","HTML","CSS"],
        "age": 32
    }
]
          </pre>
        </section>
      </article>

      <article class="smaller">
        <h2>
          Adding data to CouchDB
        </h2>
        <br />
        <p>add _id to the data</p>
        <section>
          <pre>
kanso transform add-ids data.json data_and_ids.json 
Fetching 1000 UUIDs from http://localhost:5984/
Transformed 3 docs
OK: Saved 3 docs to data_and_ids.json
          </pre>
        </section>
        <p>now to the database</p>
        <section>
          <pre>
kanso upload data_and_ids.json http://localhost:5984/jug-kanso 
Uploading docs to http://localhost:5984/jug-kanso
Reading data_and_ids.json
Saved 171fd70ba9d8b42b40598f0a6e1f6ef3 (data_and_ids.json, entry: 2)
Saved 171fd70ba9d8b42b40598f0a6e1f7843 (data_and_ids.json, entry: 3)
Saved 171fd70ba9d8b42b40598f0a6e1f6bf9 (data_and_ids.json, entry: 1)
Uploaded 3 docs
OK: Uploaded 3 of 3 docs
          </pre>
        </section>
      </article>

      <article>
        <h2>
          Querying documents for the page
        </h2>
        <br />
        <p>adding a view in lib/views.js</p>
        <br />
        <section>
          <pre>
exports.views = {
  attendees: {
    map: function (doc) {
      emit([doc.first_name, doc.last_name], doc.coding_skills);
    }
  }
};
          </pre>
        </section>
      </article>

      <article class="smaller">
        <h2>
          lib/jug.js
        </h2>
        <section>
          <pre style="line-height: 17px">
var db = require('db').current();
exports.get_data = function () {
  var $get_data = $('.js_get_data'), mod = this;

  mod.init = function () {
    $get_data.on('click', function (e) {
      e.preventDefault();
      mod.get_data();
    });
  }

  mod.get_data = function () {
    db.getView('jug-kanso', 'attendees', function (err, data) {
      if (err) {
        mod.write_data(err);
      }
      var out = '';
      for (var i = 0; i < data.rows.length; i++) {
        out += data.rows[i].key[1] + ', ' + data.rows[i].key[0] + ': ' +  
          data.rows[i].value  + '&lt;br /&gt;';
      }
      mod.write_data(out);
    });
  }

  mod.write_data = function (data) {
    $('#data').html(data);
  }

  return {
    init: mod.init()
  }
}
          </pre>
        </section>
      </article>

      <article>
        <h2>
          The result
        </h2>
        <br />
        <p><img src="images/kanso-result.png" /></p>
      </article>

       <article>
        <h2>
          Kanso is awesome
        </h2>
        <br />
        <ul>
          <li>porbably the most comfortable tool for building CouchApps</li>
          <li>check out <a href="http://kan.so">kan.so</a> - especially the third party modules</li>
          <li>and ... don't forget to <span class="red">RELAX</span></li>
        </ul>
      </article>

      <article>
        <div style="text-align: center">
          <h2>
            THANK YOU
          </h2>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>... questions?</p>
        </div>
      </article>
      </article>
    </section>
  </body>
</html>
